---
image:
  name: maven:3.8-openjdk-8-slim
  entrypoint: [""]  # Переопределение "точки входа" в контейнер который запускается ранером при сборке

variables:
  #GRADLE_OPTS: "-Dorg.gradle.daemon=false"
  #GRADLE_USER_HOME: /build/.gradle

stages:
  - test

# Запускаем тесты
run_regression_tests_job: #Test_&_send:
  except:
    - merge_requests
    - pushes
#    - tags
#    - triggers
#    - schedules
  only:
    variables:
      - $RUN_TYPE == "testng"
  artifacts:          # Имеет смысл в случае ошибки при выполнении теста результат пихать в артефакты гитлаба для анализа
    expire_in: 1 days
    when: on_failure
    paths:
      - mvn/**/*
      - result.json
  before_script:
#    - mkdir -p /share && mount.cifs //172.31.197.220/atst /share -o username=User,password=Start123,file_mode=0766,dir_mode=0766
    - export TZ=Europe/Moscow
  script:
    - echo $RUN_TYPE
    - whoami
    - chmod +x ./send_results.sh
    - mvn test -Dsurefire.suiteXmlFiles=testng.xml || echo "[ERROR] Выполнение тестов завершилось с ошибкой"
    - sh send_results.sh || echo "[ERROR] Отправка результатов в Allure завершилась с ошибкой"
  stage: test
#  tags: [gitlabw-inf-07]
